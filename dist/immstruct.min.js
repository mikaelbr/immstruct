/**
* immstruct v1.4.0
* Authors: Mikael Brevik, @torgeir
***************************************/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.immstruct=t()}}(function(){return function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";function r(){return this instanceof r?void(this.instances={}):new r}function i(t,e){if("object"==typeof e.key?(e.data=e.key,e.key=void 0):"number"==typeof e.key?(e.data=e.historyLimit,e.historyLimit=e.key,e.key=void 0):"object"==typeof e.historyLimit&&(e.data=e.historyLimit,e.historyLimit=void 0),e.key&&t.instances[e.key])return t.instances[e.key];var n=new o(e);return t.instances[n.key]=n,n}var o=t("./src/structure");r.prototype.get=function(t,e){return i(this,{key:t,data:e})},r.prototype.clear=function(){this.instances={}},r.prototype.remove=function(t){return delete this.instances[t]},r.prototype.withHistory=function(t,e,n){return i(this,{key:t,data:n,history:!0,historyLimit:e})};var s=new r;e.exports=function(t,e){return i(s,{key:t,data:e})},e.exports.withHistory=function(t,e,n){return i(s,{key:t,data:n,history:!0,historyLimit:e})},e.exports.Structure=o,e.exports.Immstruct=r,e.exports.clear=s.clear.bind(s),e.exports.remove=s.remove.bind(s),e.exports.get=s.get.bind(s),Object.defineProperty(e.exports,"instances",{get:function(){return s.instances},enumerable:!0,configurable:!0})},{"./src/structure":4}],2:[function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,r=new Array(n);n>e;e++)r[e]=this._events[t][e].fn;return r},i.prototype.emit=function(t,e,n,r,i,o){if(!this._events||!this._events[t])return!1;var s,u,c=this._events[t],a=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(t,c.fn,!0),a){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,r),!0;case 5:return c.fn.call(c.context,e,n,r,i),!0;case 6:return c.fn.call(c.context,e,n,r,i,o),!0}for(u=1,s=new Array(a-1);a>u;u++)s[u-1]=arguments[u];c.fn.apply(c.context,s)}else{var f,h=c.length;for(u=0;h>u;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,!0),a){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,n);break;default:if(!s)for(f=1,s=new Array(a-1);a>f;f++)s[f-1]=arguments[f];c[u].fn.apply(c[u].context,s)}}return!0},i.prototype.on=function(t,e,n){var i=new r(e,n||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],i]:this._events[t].push(i):this._events[t]=i,this},i.prototype.once=function(t,e,n){var i=new r(e,n||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],i]:this._events[t].push(i):this._events[t]=i,this},i.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var r=this._events[t],i=[];if(e&&(r.fn&&(r.fn!==e||n&&!r.once)&&i.push(r),!r.fn))for(var o=0,s=r.length;s>o;o++)(r[o].fn!==e||n&&!r[o].once)&&i.push(r[o]);return i.length?this._events[t]=1===i.length?i[0]:i:delete this._events[t],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.EventEmitter=i,i.EventEmitter2=i,i.EventEmitter3=i,e.exports=i},{}],3:[function(t,e,n){function r(t,e,n){return 1===arguments.length?e=[]:"function"==typeof e?(n=e,e=[]):e=p(e),s(t,e,n)}function i(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function o(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function s(t,e,n,r){arguments.length<4&&(r=t.getIn(e));var s=r&&r.size,u=v.isIndexed(r)?o:i;return new u(t,e,n,s)}function u(t,e,n){return v.isIterable(n)?c(t,e,n):n}function c(t,e,n){return arguments.length<3?s(t._rootData,f(t._keyPath,e),t._onChange):s(t._rootData,f(t._keyPath,e),t._onChange,n)}function a(t,e,n){var r=arguments.length>2,i=t._rootData.updateIn(t._keyPath,r?m():void 0,e),o=t._keyPath||[],u=t._onChange&&t._onChange.call(void 0,i,t._rootData,r?f(o,n):o);return void 0!==u&&(i=u),s(i,t._keyPath,t._onChange)}function f(t,e){return t.concat(h(e))}function h(t){return Array.isArray(t)?t:y.Iterable(t).toArray()}function p(t){return Array.isArray(t)?t:v.isIterable(t)?t.toArray():[t]}var y="undefined"!=typeof window?window.Immutable:"undefined"!=typeof global?global.Immutable:null,v=y.Iterable,d=v.Iterator,l=y.Seq,m=y.Map,_=Object.create(l.Keyed.prototype),g=Object.create(l.Indexed.prototype);_.constructor=i,g.constructor=o,_.toString=function(){return this.__toString("Cursor {","}")},g.toString=function(){return this.__toString("Cursor [","]")},_.deref=_.valueOf=g.deref=g.valueOf=function(t){return this._rootData.getIn(this._keyPath,t)},_.get=g.get=function(t,e){return this.getIn([t],e)},_.getIn=g.getIn=function(t,e){if(t=h(t),0===t.length)return this;var n=this._rootData.getIn(f(this._keyPath,t),b);return n===b?e:u(this,t,n)},g.set=_.set=function(t,e){return a(this,function(n){return n.set(t,e)},[t])},g.push=function(){var t=arguments;return a(this,function(e){return e.push.apply(e,t)})},g.pop=function(){return a(this,function(t){return t.pop()})},g.unshift=function(){var t=arguments;return a(this,function(e){return e.unshift.apply(e,t)})},g.shift=function(){return a(this,function(t){return t.shift()})},g.setIn=_.setIn=m.prototype.setIn,_.remove=_["delete"]=g.remove=g["delete"]=function(t){return a(this,function(e){return e.remove(t)},[t])},g.removeIn=g.deleteIn=_.removeIn=_.deleteIn=m.prototype.deleteIn,_.clear=g.clear=function(){return a(this,function(t){return t.clear()})},g.update=_.update=function(t,e,n){return 1===arguments.length?a(this,t):this.updateIn([t],e,n)},g.updateIn=_.updateIn=function(t,e,n){return a(this,function(r){return r.updateIn(t,e,n)},t)},g.merge=_.merge=function(){var t=arguments;return a(this,function(e){return e.merge.apply(e,t)})},g.mergeWith=_.mergeWith=function(t){var e=arguments;return a(this,function(t){return t.mergeWith.apply(t,e)})},g.mergeIn=_.mergeIn=m.prototype.mergeIn,g.mergeDeep=_.mergeDeep=function(){var t=arguments;return a(this,function(e){return e.mergeDeep.apply(e,t)})},g.mergeDeepWith=_.mergeDeepWith=function(t){var e=arguments;return a(this,function(t){return t.mergeDeepWith.apply(t,e)})},g.mergeDeepIn=_.mergeDeepIn=m.prototype.mergeDeepIn,_.withMutations=g.withMutations=function(t){return a(this,function(e){return(e||m()).withMutations(t)})},_.cursor=g.cursor=function(t){return t=p(t),0===t.length?this:c(this,t)},_.__iterate=g.__iterate=function(t,e){var n=this,r=n.deref();return r&&r.__iterate?r.__iterate(function(e,r){return t(u(n,[r],e),r,n)},e):0},_.__iterator=g.__iterator=function(t,e){var n=this.deref(),r=this,i=n&&n.__iterator&&n.__iterator(d.ENTRIES,e);return new d(function(){if(!i)return{value:void 0,done:!0};var e=i.next();if(e.done)return e;var n=e.value,o=n[0],s=u(r,[o],n[1]);return{value:t===d.KEYS?o:t===d.VALUES?s:[o,s],done:!1}})},i.prototype=_,o.prototype=g;var b={};n.from=r},{immutable:void 0}],4:[function(t,e,n){(function(n){"use strict";function r(t){var e=this;return t=t||{},this instanceof r?(this.key=t.key||g.generateRandomKey(),this.current=t.data,p(this.current)&&this.current||(this.current=l.fromJS(this.current||{})),t.history&&(this.history=l.List.of(this.current),this._currentRevision=0,this._historyLimit="number"==typeof t.historyLimit?t.historyLimit:1/0),this._referencelisteners=l.Map(),this._pathListeners=l.Map(),this.on("swap",function(t,n,r){a(r).reduce(function(t,n){return t.concat(e._referencelisteners.get(l.List(n),l.Set()))},l.Set()).forEach(function(e){e(r,t,n)})}),void _.call(this,arguments)):new r(t)}function i(t,e){return function(n,r,i){var o=e.apply(e,arguments);return t.history&&n!==r?(t.history=t.history.take(++t._currentRevision).push(t.current),t.history.size>t._historyLimit&&(t.history=t.history.takeLast(t._historyLimit),t._currentRevision-=t.history.size-t._historyLimit),o):o}}function o(t,e){return function(n,r,i){var o=e.apply(e,arguments);return n===r?o:(t.emit("swap",o,r,i),b(t,o,r,i),o)}}function s(t,e){return function(n,r,i){var o=e.apply(e,arguments);if(n===r)return o;var s=u(n,r,i);return s.eventName&&t.emit.apply(t,[s.eventName].concat(s.args)),o}}function u(t,e,n){var r,i,o=e&&e.getIn(n),s=t&&t.getIn(n),u=e&&c(e,n),a=t&&c(t,n);return u&&!a?(i="delete",r=[n,o]):u&&a?(i="change",r=[n,s,o]):!u&&a&&(i="add",r=[n,s]),{eventName:i,args:r}}function c(t,e){return t.hasIn?t.hasIn(e):t.getIn(e,I)!==I}function a(t){var e=(t||[]).reduce(function(t,e){return t.push(t[t.length-1].concat(e)),t},[[]]);return e}function f(t,e){return function(n,r,i){var o=u(r,i,n);if(o.eventName===t)return e.apply(e,o.args)}}function h(t){return t&&"function"==typeof t.deref}function p(t){return y("Iterable","isIterable",t)||y("Seq","isSeq",t)||y("Map","isMap",t)||y("OrderedMap","isOrderedMap",t)||y("List","isList",t)||y("Stack","isStack",t)||y("Set","isSet",t)}function y(t,e,n){return l[t]&&l[t][e]&&l[t][e](n)}function v(t){return"undefined"==typeof t?t:Array.isArray(t)?t:y("Iterable","isIterable",t)?t.toArray():[t]}function d(t,e){var n={};Object.getOwnPropertyNames(t.prototype).forEach(function(e){n[e]=Object.getOwnPropertyDescriptor(t.prototype,e)}),t.prototype=Object.create(e.prototype,n),t["super"]=e}var l="undefined"!=typeof window?window.Immutable:"undefined"!=typeof n?n.Immutable:null,m=t("immutable/contrib/cursor/index"),_=t("eventemitter3").EventEmitter,g=t("./utils");d(r,_),e.exports=r,r.prototype._subscribe=function(t,e){this._referencelisteners=a(t).reduce(function(t,n){return t.updateIn([l.List(n)],l.Set(),function(t){return t.add(e)})},this._referencelisteners)},r.prototype._unsubscribe=function(t,e){this._referencelisteners=a(t).reduce(function(t,n){return t.updateIn([l.List(n)],l.Set(),function(t){return t.remove(e)})},this._referencelisteners)},r.prototype.cursor=function(t){var e=this;if(t=v(t)||[],!this.current)throw new Error("No structure loaded.");var n=function(t,n,r){return e.current===n?e.current=t:c(t,r)?e.current=e.current.setIn(r,t.getIn(r)):e.current=e.current.removeIn(r),e.current};return n=i(this,n),n=o(this,n),n=s(this,n),m.from(e.current,t,n)},r.prototype.reference=function(t){function e(){r=n.cursor(t)}h(t)&&t._keyPath&&(t=t._keyPath),t=v(t)||[];var n=this,r=this.cursor(t),i=l.Set();return this._subscribe(t,e),{observe:function(e,r){return"function"==typeof e&&(r=e,e=void 0),this._dead||"function"!=typeof r?void 0:(e&&"swap"!==e&&(r=f(e,r)),n._subscribe(t,r),i=i.add(r),function(){n._unsubscribe(t,r)})},cursor:function(t){return t=v(t),t?r.cursor(t):r},unobserveAll:function(r){i.forEach(function(e){n._unsubscribe(t,e)}),r&&n._unsubscribe(t,e)},destroy:function(){this.unobserveAll(!0),r=void 0,this._dead=!0,this.observe=void 0,this.unobserveAll=void 0,this.cursor=void 0,this.destroy=void 0}}},r.prototype.forceHasSwapped=function(t,e,n){this.emit("swap",t||this.current,e,n),b(this,t||this.current,e,n)},r.prototype.undo=function(t){return this._currentRevision-=t||1,this._currentRevision<0&&(this._currentRevision=0),this.current=this.history.get(this._currentRevision),this.current},r.prototype.redo=function(t){return this._currentRevision+=t||1,this._currentRevision>this.history.count()-1&&(this._currentRevision=this.history.count()-1),this.current=this.history.get(this._currentRevision),this.current},r.prototype.undoUntil=function(t){return this._currentRevision=this.history.indexOf(t),this.current=t,t};var b=function(){var t=!1;return"function"!=typeof requestAnimationFrame?function(){}:function(e,n,r,i){t||(t=!0,requestAnimationFrame(function(){t=!1,e.emit("next-animation-frame",n,r,i)}))}}(),I={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":5,eventemitter3:2,"immutable/contrib/cursor/index":3}],5:[function(t,e,n){"use strict";e.exports.generateRandomKey=function(t){return t=t||10,Math.random().toString(36).substring(2).substring(0,t)}},{}]},{},[1])(1)});