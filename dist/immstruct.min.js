/**
* immstruct v1.5.0
* Authors: Mikael Brevik, @torgeir
***************************************/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.immstruct=t()}}(function(){return function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";function r(){return this instanceof r?void(this.instances={}):new r}function i(t,e){if("object"==typeof e.key&&(e.data=e.key,e.key=void 0),e.key&&t.instances[e.key])return t.instances[e.key];var n=new o(e);return t.instances[n.key]=n,n}var o=t("./src/structure");r.prototype.get=function(t,e){return i(this,{key:t,data:e})},r.prototype.clear=function(){this.instances={}},r.prototype.remove=function(t){return delete this.instances[t]},r.prototype.withHistory=function(t,e){return i(this,{key:t,data:e,history:!0})};var s=new r;e.exports=function(t,e){return i(s,{key:t,data:e})},e.exports.withHistory=function(t,e){return i(s,{key:t,data:e,history:!0})},e.exports.Structure=o,e.exports.Immstruct=r,e.exports.clear=s.clear.bind(s),e.exports.remove=s.remove.bind(s),e.exports.get=s.get.bind(s),Object.defineProperty(e.exports,"instances",{get:function(){return s.instances},enumerable:!0,configurable:!0})},{"./src/structure":5}],2:[function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,r=new Array(n);n>e;e++)r[e]=this._events[t][e].fn;return r},i.prototype.emit=function(t,e,n,r,i,o){if(!this._events||!this._events[t])return!1;var s,u,c=this._events[t],a=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(t,c.fn,!0),a){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,r),!0;case 5:return c.fn.call(c.context,e,n,r,i),!0;case 6:return c.fn.call(c.context,e,n,r,i,o),!0}for(u=1,s=new Array(a-1);a>u;u++)s[u-1]=arguments[u];c.fn.apply(c.context,s)}else{var f,h=c.length;for(u=0;h>u;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,!0),a){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,n);break;default:if(!s)for(f=1,s=new Array(a-1);a>f;f++)s[f-1]=arguments[f];c[u].fn.apply(c[u].context,s)}}return!0},i.prototype.on=function(t,e,n){var i=new r(e,n||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],i]:this._events[t].push(i):this._events[t]=i,this},i.prototype.once=function(t,e,n){var i=new r(e,n||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],i]:this._events[t].push(i):this._events[t]=i,this},i.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var r=this._events[t],i=[];if(e&&(r.fn&&(r.fn!==e||n&&!r.once)&&i.push(r),!r.fn))for(var o=0,s=r.length;s>o;o++)(r[o].fn!==e||n&&!r[o].once)&&i.push(r[o]);return i.length?this._events[t]=1===i.length?i[0]:i:delete this._events[t],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.EventEmitter=i,i.EventEmitter2=i,i.EventEmitter3=i,e.exports=i},{}],3:[function(t,e,n){function r(t,e,n){return 1===arguments.length?e=[]:"function"==typeof e?(n=e,e=[]):e=p(e),s(t,e,n)}function i(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function o(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function s(t,e,n,r){arguments.length<4&&(r=t.getIn(e));var s=r&&r.size,u=l.isIndexed(r)?o:i;return new u(t,e,n,s)}function u(t,e,n){return l.isIterable(n)?c(t,e,n):n}function c(t,e,n){return arguments.length<3?s(t._rootData,f(t._keyPath,e),t._onChange):s(t._rootData,f(t._keyPath,e),t._onChange,n)}function a(t,e,n){var r=arguments.length>2,i=t._rootData.updateIn(t._keyPath,r?_():void 0,e),o=t._keyPath||[],u=t._onChange&&t._onChange.call(void 0,i,t._rootData,r?f(o,n):o);return void 0!==u&&(i=u),s(i,t._keyPath,t._onChange)}function f(t,e){return t.concat(h(e))}function h(t){return Array.isArray(t)?t:v.Iterable(t).toArray()}function p(t){return Array.isArray(t)?t:l.isIterable(t)?t.toArray():[t]}var v="undefined"!=typeof window?window.Immutable:"undefined"!=typeof global?global.Immutable:null,l=v.Iterable,d=l.Iterator,y=v.Seq,_=v.Map,g=Object.create(y.Keyed.prototype),m=Object.create(y.Indexed.prototype);g.constructor=i,m.constructor=o,g.toString=function(){return this.__toString("Cursor {","}")},m.toString=function(){return this.__toString("Cursor [","]")},g.deref=g.valueOf=m.deref=m.valueOf=function(t){return this._rootData.getIn(this._keyPath,t)},g.get=m.get=function(t,e){return this.getIn([t],e)},g.getIn=m.getIn=function(t,e){if(t=h(t),0===t.length)return this;var n=this._rootData.getIn(f(this._keyPath,t),b);return n===b?e:u(this,t,n)},m.set=g.set=function(t,e){return a(this,function(n){return n.set(t,e)},[t])},m.push=function(){var t=arguments;return a(this,function(e){return e.push.apply(e,t)})},m.pop=function(){return a(this,function(t){return t.pop()})},m.unshift=function(){var t=arguments;return a(this,function(e){return e.unshift.apply(e,t)})},m.shift=function(){return a(this,function(t){return t.shift()})},m.setIn=g.setIn=_.prototype.setIn,g.remove=g["delete"]=m.remove=m["delete"]=function(t){return a(this,function(e){return e.remove(t)},[t])},m.removeIn=m.deleteIn=g.removeIn=g.deleteIn=_.prototype.deleteIn,g.clear=m.clear=function(){return a(this,function(t){return t.clear()})},m.update=g.update=function(t,e,n){return 1===arguments.length?a(this,t):this.updateIn([t],e,n)},m.updateIn=g.updateIn=function(t,e,n){return a(this,function(r){return r.updateIn(t,e,n)},t)},m.merge=g.merge=function(){var t=arguments;return a(this,function(e){return e.merge.apply(e,t)})},m.mergeWith=g.mergeWith=function(t){var e=arguments;return a(this,function(t){return t.mergeWith.apply(t,e)})},m.mergeIn=g.mergeIn=_.prototype.mergeIn,m.mergeDeep=g.mergeDeep=function(){var t=arguments;return a(this,function(e){return e.mergeDeep.apply(e,t)})},m.mergeDeepWith=g.mergeDeepWith=function(t){var e=arguments;return a(this,function(t){return t.mergeDeepWith.apply(t,e)})},m.mergeDeepIn=g.mergeDeepIn=_.prototype.mergeDeepIn,g.withMutations=m.withMutations=function(t){return a(this,function(e){return(e||_()).withMutations(t)})},g.cursor=m.cursor=function(t){return t=p(t),0===t.length?this:c(this,t)},g.__iterate=m.__iterate=function(t,e){var n=this,r=n.deref();return r&&r.__iterate?r.__iterate(function(e,r){return t(u(n,[r],e),r,n)},e):0},g.__iterator=m.__iterator=function(t,e){var n=this.deref(),r=this,i=n&&n.__iterator&&n.__iterator(d.ENTRIES,e);return new d(function(){if(!i)return{value:void 0,done:!0};var e=i.next();if(e.done)return e;var n=e.value,o=n[0],s=u(r,[o],n[1]);return{value:t===d.KEYS?o:t===d.VALUES?s:[o,s],done:!1}})},i.prototype=g,o.prototype=m;var b={};n.from=r},{immutable:void 0}],4:[function(t,e,n){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],5:[function(t,e,n){(function(n){"use strict";function r(t){var e=this;return t=t||{},this instanceof r?(this.key=t.key||I.generateRandomKey(),this.current=t.data,d(this.current)&&this.current||(this.current=_.fromJS(this.current||{})),t.history&&(this.history=_.List.of(this.current),this._currentRevision=0),this._pathListeners={},this.on("swap",function(t,n,r){h(e._pathListeners,f(r)).forEach(function(e){"function"==typeof e&&e(t,n,r)})}),void m.call(this,arguments)):new r(t)}function i(t,e){return function(n,r,i){var o=e.apply(e,arguments);return t.history&&n!==r?(t.history=t.history.take(++t._currentRevision).push(t.current),o):o}}function o(t,e){return function(n,r,i){var o=e.apply(e,arguments);return n===r?o:(t.emit("swap",o,r,i),w(t,o,r,i),o)}}function s(t,e){return function(n,r,i){var o=e.apply(e,arguments);if(n===r)return o;var s=c(n,r,i);return s.eventName&&t.emit.apply(t,[s.eventName].concat(s.args)),o}}function u(t,e){if(t)for(var n,r=0;r<t.length;r++)if(n=t[r],!e||n!==e){var i=t.indexOf(n);i>-1&&(r--,t.splice(i,1))}}function c(t,e,n){var r,i,o=e&&e.getIn(n),s=t&&t.getIn(n),u=e&&a(e,n),c=t&&a(t,n);return u&&!c?(i="delete",r=[n,o]):u&&c?(i="change",r=[n,s,o]):!u&&c&&(i="add",r=[n,s]),{eventName:i,args:r}}function a(t,e){return t.hasIn?t.hasIn(e):t.getIn(e,x)!==x}function f(t){var e="global";return t&&t.length?"string"==typeof t?e+"."+t:[e].concat(t).join("."):e}function h(t,e){var n=e.split("."),r="",i=[];return n.forEach(function(e){r=r?r+"."+e:e,i=i.concat(p(t,r))}),i}function p(t,e){var n=I.deepGet(t,e+"._listeners");return n||(n=[],I.deepSet(t,e+"._listeners",n)),n}function v(t,e){return function(n,r,i){var o=c(n,r,i);if(o.eventName===t)return e(n,r,i)}}function l(t){return t&&"function"==typeof t.deref}function d(t){return y("Iterable","isIterable",t)||y("Seq","isSeq",t)||y("Map","isMap",t)||y("OrderedMap","isOrderedMap",t)||y("List","isList",t)||y("Stack","isStack",t)||y("Set","isSet",t)}function y(t,e,n){return _[t]&&_[t][e]&&_[t][e](n)}var _="undefined"!=typeof window?window.Immutable:"undefined"!=typeof n?n.Immutable:null,g=t("immutable/contrib/cursor"),m=t("eventemitter3").EventEmitter,b=t("inherits"),I=t("./utils");b(r,m),e.exports=r,r.prototype.cursor=function(t){var e=this;if(t=t&&t.substr?t.split("."):t||[],!this.current)throw new Error("No structure loaded.");var n=function(t,n,r){return e.current=e.current===n?t:a(t,r)?e.current.setIn(r,t.getIn(r)):e.current.removeIn(r),e.current};return n=i(this,n),n=o(this,n),n=s(this,n),g.from(e.current,t,n)},r.prototype.reference=function(t){l(t)&&t._keyPath&&(t=t._keyPath),t=t&&t.substr?t.split("."):t||[];var e=this,n=f(t),r=p(e._pathListeners,n),i=this.cursor(t),o=function(){i=e.cursor(t)};return r[0]||r.push(o),{observe:function(t,e){return"function"==typeof t&&(e=t,t=void 0),this._dead||"function"!=typeof e?void 0:(t&&"swap"!==t&&(e=v(t,e)),r.push(e),function(){var t=r.indexOf(e);t>-1&&r.splice(t,1)})},cursor:function(t){return t=t&&t.substr?t.split("."):t||[],t?i.cursor(t):i},unobserveAll:function(){u(r,o)},destroy:function(){u(r),i=void 0,this._dead=!0,this.observe=void 0,this.unobserveAll=void 0,this.cursor=void 0,this.destroy=void 0}}},r.prototype.forceHasSwapped=function(t,e,n){this.emit("swap",t||this.current,e,n),w(this,t||this.current,e,n)},r.prototype.undo=function(t){return this._currentRevision-=t||1,this._currentRevision<0&&(this._currentRevision=0),this.current=this.history.get(this._currentRevision),this.current},r.prototype.redo=function(t){return this._currentRevision+=t||1,this._currentRevision>this.history.count()-1&&(this._currentRevision=this.history.count()-1),this.current=this.history.get(this._currentRevision),this.current},r.prototype.undoUntil=function(t){return this._currentRevision=this.history.indexOf(t),this.current=t,t};var w=function(){var t=!1;return"function"!=typeof requestAnimationFrame?function(){}:function(e,n,r,i){t||(t=!0,requestAnimationFrame(function(){t=!1,e.emit("next-animation-frame",n,r,i)}))}}(),x={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":6,eventemitter3:2,"immutable/contrib/cursor":3,inherits:4}],6:[function(t,e,n){"use strict";function r(t){var e=[];return e[t]=null,e.length>0}e.exports.generateRandomKey=function(t){return t=t||10,Math.random().toString(36).substring(2).substring(0,t)},e.exports.deepGet=function(t,e){var n=t,r=e.split(".");return r.forEach(function(t){return n&&t in n?void(n=n[t]):(n=void 0,!1)}),n},e.exports.deepSet=function(t,e,n){var i=t,o=e.split(".");return o.forEach(function(t,e){e+1===o.length?i[t]=n:"object"!=typeof i[t]&&(i[t]=r(o[e+1])?[]:{}),i=i[t]}),t}},{}]},{},[1])(1)});